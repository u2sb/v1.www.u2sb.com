---
title: 安装和基本介绍
date: 2022-05-18 17:03:27
permalink: /pages/15f418/
categories:
  - 开源项目
tags:
  - 开源项目
  - Danmu.Server
---

## 基本介绍

这是一个通用的弹幕服务器，并且可以解析 B 站的视频弹幕。

## 安装

:::Warning
目前 2.x 版本未正式发布，如想要体验，可以使用我搭建好的服务器，或者是自行编译。
:::

### 流程

- 下载预编译文件到服务器
- 编辑配置文件 `appsettings.json`
- 配置进程守护
- 配置反向代理
- 测试

### 下载

预编译文件下载地址 ~~[最新版本]()~~

授予运行权限

```bash
sudo chmod +x DanMu
```

### 配置

编辑 `appsettings.json`

```json
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "Kestrel": {
    "Endpoints": {
      "Http": {
        "Url": "http://localhost:5000",
        "Protocols": "Http1AndHttp2AndHttp3"
      }
    }
  },
  "AllowedHosts": "*",
  "WithOrigins": ["*"],
  "BiliBiliSetting": {
    "PageCacheTime": 8640,
    "DanMuCacheTime": 6
  },
  "DataBase": {
    "Directory": "DataBase",
    "DanMuCachingDb": "DanMuCaching.db",
    "DanMuDb": "DanMu.db"
  }
}
```

需要修改的部分

- `Kestrel.Endpoints.Http.Url` 修改为不冲突的端口
- `AllowedHosts` 添加自己的域名，多个域名使用 `;` 隔开，如 `"danmu.u2sb.com;localhost"`
- `WithOrigins` 允许跨域请求的域名，默认不需要修改

### 配置进程守护

以 `supervisor` 为例

```ini
[program:danmu.server]

directory=/www/danmu.server/
command=/www/danmu.server/DanMu

autostart=true
autorestart=true
startsecs=3
user=root

stderr_logfile=/www/danmu.server/logs/error.log
stdout_logfile=/www/danmu.server/logs/out.log

stderr_logfile_maxbytes=5MB
stderr_logfile_backups=20
stdout_logfile_maxbytes=5MB
```

### 配置反向代理

以 caddy 为例

```
danmu.u2sb.com {
  encode zstd br gzip
  reverse_proxy localhost:5000
}
```

## 感谢

本项目开发过程中参考了以下项目，在此表示感谢：

- [Bili.Uwp](https://github.com/Richasy/Bili.Uwp)
- [bilibili-API-collect](https://github.com/SocialSisterYi/bilibili-API-collect)
